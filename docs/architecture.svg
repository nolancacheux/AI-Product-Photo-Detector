<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 1060" width="960" height="1060" font-family="Segoe UI, Arial, sans-serif">
  <defs>
    <!-- Background patterns & gradients -->
    <linearGradient id="bgGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#f8f9fa"/>
      <stop offset="100%" stop-color="#e9ecef"/>
    </linearGradient>
    <!-- Section fills -->
    <linearGradient id="dataGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#d4edda"/>
      <stop offset="100%" stop-color="#c3e6cb"/>
    </linearGradient>
    <linearGradient id="trainGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#ffeeba"/>
      <stop offset="100%" stop-color="#ffd89b"/>
    </linearGradient>
    <linearGradient id="inferGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#cce5ff"/>
      <stop offset="100%" stop-color="#b8daff"/>
    </linearGradient>
    <linearGradient id="monGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#e2d5f1"/>
      <stop offset="100%" stop-color="#d4c5e9"/>
    </linearGradient>
    <linearGradient id="infraGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#e2e3e5"/>
      <stop offset="100%" stop-color="#d6d8db"/>
    </linearGradient>
    <linearGradient id="vertexGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fce4ec"/>
      <stop offset="100%" stop-color="#f8bbd0"/>
    </linearGradient>
    <linearGradient id="colabGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fff8e1"/>
      <stop offset="100%" stop-color="#ffecb3"/>
    </linearGradient>
    <linearGradient id="pathsGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#f0f4f8"/>
      <stop offset="100%" stop-color="#e4e9f0"/>
    </linearGradient>
    <!-- Arrow marker -->
    <marker id="arrow" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 Z" fill="#495057"/>
    </marker>
    <marker id="arrowBlue" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 Z" fill="#0069d9"/>
    </marker>
    <marker id="arrowPurple" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 Z" fill="#7b4fa0"/>
    </marker>
    <marker id="arrowRed" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 Z" fill="#c62828"/>
    </marker>
    <marker id="arrowOrange" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 Z" fill="#e67e22"/>
    </marker>
    <marker id="arrowColab" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 Z" fill="#f57f17"/>
    </marker>
    <marker id="arrowGreen" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 Z" fill="#28a745"/>
    </marker>
    <!-- Drop shadow -->
    <filter id="shadow" x="-2%" y="-2%" width="104%" height="104%">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-opacity="0.12"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="960" height="1060" rx="8" fill="url(#bgGrad)"/>

  <!-- Title -->
  <text x="480" y="28" text-anchor="middle" font-size="16" font-weight="700" fill="#212529">AI Product Photo Detector ‚Äî System Architecture</text>
  <text x="480" y="44" text-anchor="middle" font-size="9" fill="#6c757d">EfficientNet-B0 binary classifier  |  FastAPI + Streamlit  |  Vertex AI + GCS  |  GCP Cloud Run  |  DVC + MLflow</text>

  <!-- ============================================================ -->
  <!-- SECTION 1: DATA LAYER (green) -->
  <!-- ============================================================ -->
  <rect x="14" y="56" width="290" height="260" rx="10" fill="url(#dataGrad)" stroke="#28a745" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="159" y="74" text-anchor="middle" font-size="11" font-weight="700" fill="#155724">DATA LAYER</text>

  <!-- Kaggle API -->
  <rect x="28" y="84" width="120" height="36" rx="6" fill="#fff" stroke="#28a745" stroke-width="1"/>
  <text x="88" y="99" text-anchor="middle" font-size="8.5" font-weight="600" fill="#155724">Kaggle API</text>
  <text x="88" y="111" text-anchor="middle" font-size="7" fill="#495057">CIFAKE Dataset</text>

  <!-- Raw Dataset -->
  <rect x="170" y="84" width="120" height="36" rx="6" fill="#fff" stroke="#28a745" stroke-width="1"/>
  <text x="230" y="99" text-anchor="middle" font-size="8.5" font-weight="600" fill="#155724">Raw Dataset</text>
  <text x="230" y="111" text-anchor="middle" font-size="7" fill="#495057">real/ + ai/ images</text>

  <!-- Arrow: Kaggle -> Raw -->
  <line x1="148" y1="102" x2="168" y2="102" stroke="#495057" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- DVC Pipeline box -->
  <rect x="28" y="130" width="262" height="80" rx="6" fill="#fff" stroke="#28a745" stroke-width="1"/>
  <text x="159" y="145" text-anchor="middle" font-size="8.5" font-weight="700" fill="#155724">DVC Pipeline (dvc.yaml)</text>

  <!-- Pipeline stages -->
  <rect x="38" y="153" width="70" height="22" rx="4" fill="#e8f5e9" stroke="#66bb6a" stroke-width="0.8"/>
  <text x="73" y="167" text-anchor="middle" font-size="7" font-weight="600" fill="#2e7d32">download</text>

  <rect x="118" y="153" width="70" height="22" rx="4" fill="#e8f5e9" stroke="#66bb6a" stroke-width="0.8"/>
  <text x="153" y="167" text-anchor="middle" font-size="7" font-weight="600" fill="#2e7d32">validate</text>

  <rect x="198" y="153" width="82" height="22" rx="4" fill="#e8f5e9" stroke="#66bb6a" stroke-width="0.8"/>
  <text x="239" y="167" text-anchor="middle" font-size="7" font-weight="600" fill="#2e7d32">train + evaluate</text>

  <!-- Stage arrows -->
  <line x1="108" y1="164" x2="116" y2="164" stroke="#495057" stroke-width="0.8" marker-end="url(#arrow)"/>
  <line x1="188" y1="164" x2="196" y2="164" stroke="#495057" stroke-width="0.8" marker-end="url(#arrow)"/>

  <text x="159" y="198" text-anchor="middle" font-size="7" fill="#495057">Tracked with DVC remote storage</text>

  <!-- Data Validation -->
  <rect x="28" y="220" width="262" height="42" rx="6" fill="#fff" stroke="#28a745" stroke-width="1"/>
  <text x="159" y="236" text-anchor="middle" font-size="8.5" font-weight="600" fill="#155724">Data Validation</text>
  <text x="159" y="248" text-anchor="middle" font-size="7" fill="#495057">Class balance | Corrupt images | Resolution stats</text>
  <text x="159" y="257" text-anchor="middle" font-size="6.5" fill="#6c757d">src/data/validate.py  ‚Äî  reports/data_validation.json</text>

  <!-- Arrow: Raw -> DVC -->
  <line x1="230" y1="120" x2="230" y2="128" stroke="#495057" stroke-width="1.0" marker-end="url(#arrow)"/>

  <!-- ============================================================ -->
  <!-- SECTION 2: 3 TRAINING PATHS (master section) -->
  <!-- ============================================================ -->
  <rect x="14" y="326" width="932" height="360" rx="10" fill="url(#pathsGrad)" stroke="#495057" stroke-width="1.4" filter="url(#shadow)"/>
  <text x="480" y="346" text-anchor="middle" font-size="13" font-weight="700" fill="#212529">3 TRAINING PATHS</text>
  <text x="480" y="360" text-anchor="middle" font-size="8" fill="#6c757d">EfficientNet-B0 ‚Äî same model architecture, different environments and workflows</text>

  <!-- ‚îÄ‚îÄ‚îÄ PATH 1: LOCAL TRAINING (orange) ‚îÄ‚îÄ‚îÄ -->
  <rect x="26" y="372" width="286" height="300" rx="8" fill="url(#trainGrad)" stroke="#e67e22" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="169" y="390" text-anchor="middle" font-size="10" font-weight="700" fill="#7c4a03">‚ë† LOCAL TRAINING</text>
  <text x="169" y="402" text-anchor="middle" font-size="7" fill="#7c4a03">Development &amp; experimentation</text>

  <!-- Data Source -->
  <rect x="38" y="412" width="262" height="30" rx="5" fill="#fff" stroke="#e67e22" stroke-width="0.8"/>
  <text x="169" y="425" text-anchor="middle" font-size="7.5" font-weight="600" fill="#7c4a03">üìÅ Local Dataset (DVC tracked)</text>
  <text x="169" y="436" text-anchor="middle" font-size="6.5" fill="#495057">data/processed/train, val, test</text>

  <line x1="169" y1="442" x2="169" y2="450" stroke="#e67e22" stroke-width="0.8" marker-end="url(#arrowOrange)"/>

  <!-- Training Env -->
  <rect x="38" y="452" width="262" height="52" rx="5" fill="#fff" stroke="#e67e22" stroke-width="0.8"/>
  <text x="169" y="467" text-anchor="middle" font-size="7.5" font-weight="600" fill="#7c4a03">üñ•Ô∏è Local Machine (CPU/GPU)</text>
  <text x="169" y="479" text-anchor="middle" font-size="6.5" fill="#495057">DVC pipeline orchestration</text>
  <text x="169" y="490" text-anchor="middle" font-size="6.5" fill="#495057">PyTorch + timm | Cosine LR + Warmup</text>
  <text x="169" y="500" text-anchor="middle" font-size="6" fill="#6c757d">dvc repro ‚Üí train + evaluate stages</text>

  <line x1="169" y1="504" x2="169" y2="512" stroke="#e67e22" stroke-width="0.8" marker-end="url(#arrowOrange)"/>

  <!-- Tracking -->
  <rect x="38" y="514" width="262" height="40" rx="5" fill="#fff" stroke="#e67e22" stroke-width="0.8"/>
  <text x="169" y="529" text-anchor="middle" font-size="7.5" font-weight="600" fill="#7c4a03">üìä MLflow Tracking</text>
  <text x="169" y="541" text-anchor="middle" font-size="6.5" fill="#495057">Experiments, params, metrics, artifacts</text>
  <text x="169" y="550" text-anchor="middle" font-size="6" fill="#6c757d">mlruns/ local | optional remote server</text>

  <line x1="169" y1="554" x2="169" y2="562" stroke="#e67e22" stroke-width="0.8" marker-end="url(#arrowOrange)"/>

  <!-- Model Artifact -->
  <rect x="38" y="564" width="262" height="30" rx="5" fill="#fff" stroke="#e67e22" stroke-width="0.8"/>
  <text x="169" y="577" text-anchor="middle" font-size="7.5" font-weight="600" fill="#7c4a03">üíæ best_model.pt</text>
  <text x="169" y="588" text-anchor="middle" font-size="6.5" fill="#495057">DVC tracked ‚Üí manual deploy or push to GCS</text>

  <!-- Deployment note -->
  <rect x="38" y="600" width="262" height="30" rx="5" fill="#fff3e0" stroke="#e67e22" stroke-width="0.6"/>
  <text x="169" y="613" text-anchor="middle" font-size="7" font-weight="600" fill="#7c4a03">üöÄ Manual deploy via Makefile</text>
  <text x="169" y="624" text-anchor="middle" font-size="6" fill="#6c757d">make deploy ‚Üí push model ‚Üí cd.yml triggers</text>

  <!-- Best for tag -->
  <rect x="38" y="638" width="262" height="20" rx="4" fill="#e67e22" stroke="none"/>
  <text x="169" y="652" text-anchor="middle" font-size="7" font-weight="600" fill="#fff">Best for: rapid iteration, debugging, offline work</text>


  <!-- ‚îÄ‚îÄ‚îÄ PATH 2: GOOGLE COLAB (yellow/amber) ‚îÄ‚îÄ‚îÄ -->
  <rect x="324" y="372" width="286" height="300" rx="8" fill="url(#colabGrad)" stroke="#f57f17" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="467" y="390" text-anchor="middle" font-size="10" font-weight="700" fill="#e65100">‚ë° GOOGLE COLAB</text>
  <text x="467" y="402" text-anchor="middle" font-size="7" fill="#e65100">Free GPU training notebook</text>

  <!-- Data Source -->
  <rect x="336" y="412" width="262" height="30" rx="5" fill="#fff" stroke="#f57f17" stroke-width="0.8"/>
  <text x="467" y="425" text-anchor="middle" font-size="7.5" font-weight="600" fill="#e65100">ü§ó HuggingFace Dataset</text>
  <text x="467" y="436" text-anchor="middle" font-size="6.5" fill="#495057">nolancacheux/cifake-image-dataset</text>

  <line x1="467" y1="442" x2="467" y2="450" stroke="#f57f17" stroke-width="0.8" marker-end="url(#arrowColab)"/>

  <!-- Training Env -->
  <rect x="336" y="452" width="262" height="52" rx="5" fill="#fff" stroke="#f57f17" stroke-width="0.8"/>
  <text x="467" y="467" text-anchor="middle" font-size="7.5" font-weight="600" fill="#e65100">‚òÅÔ∏è Colab Runtime (T4 GPU)</text>
  <text x="467" y="479" text-anchor="middle" font-size="6.5" fill="#495057">Free tier: NVIDIA T4 16GB VRAM</text>
  <text x="467" y="490" text-anchor="middle" font-size="6.5" fill="#495057">PyTorch + timm | Same hyperparams</text>
  <text x="467" y="500" text-anchor="middle" font-size="6" fill="#6c757d">notebooks/colab_training.ipynb</text>

  <line x1="467" y1="504" x2="467" y2="512" stroke="#f57f17" stroke-width="0.8" marker-end="url(#arrowColab)"/>

  <!-- Tracking -->
  <rect x="336" y="514" width="262" height="40" rx="5" fill="#fff" stroke="#f57f17" stroke-width="0.8"/>
  <text x="467" y="529" text-anchor="middle" font-size="7.5" font-weight="600" fill="#e65100">üìä Inline Metrics + Plots</text>
  <text x="467" y="541" text-anchor="middle" font-size="6.5" fill="#495057">Training curves, confusion matrix</text>
  <text x="467" y="550" text-anchor="middle" font-size="6" fill="#6c757d">Notebook cells with matplotlib output</text>

  <line x1="467" y1="554" x2="467" y2="562" stroke="#f57f17" stroke-width="0.8" marker-end="url(#arrowColab)"/>

  <!-- Model Artifact -->
  <rect x="336" y="564" width="262" height="30" rx="5" fill="#fff" stroke="#f57f17" stroke-width="0.8"/>
  <text x="467" y="577" text-anchor="middle" font-size="7.5" font-weight="600" fill="#e65100">üíæ best_model.pt ‚Üí Download</text>
  <text x="467" y="588" text-anchor="middle" font-size="6.5" fill="#495057">Export from Colab ‚Üí local or GCS upload</text>

  <!-- Deployment note -->
  <rect x="336" y="600" width="262" height="30" rx="5" fill="#fff8e1" stroke="#f57f17" stroke-width="0.6"/>
  <text x="467" y="613" text-anchor="middle" font-size="7" font-weight="600" fill="#e65100">üöÄ Manual export + deploy</text>
  <text x="467" y="624" text-anchor="middle" font-size="6" fill="#6c757d">Download .pt ‚Üí push to GCS ‚Üí cd.yml triggers</text>

  <!-- Best for tag -->
  <rect x="336" y="638" width="262" height="20" rx="4" fill="#f57f17" stroke="none"/>
  <text x="467" y="652" text-anchor="middle" font-size="7" font-weight="600" fill="#fff">Best for: free GPU, quick experiments, sharing</text>


  <!-- ‚îÄ‚îÄ‚îÄ PATH 3: VERTEX AI (red/pink) ‚îÄ‚îÄ‚îÄ -->
  <rect x="622" y="372" width="312" height="300" rx="8" fill="url(#vertexGrad)" stroke="#c62828" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="778" y="390" text-anchor="middle" font-size="10" font-weight="700" fill="#b71c1c">‚ë¢ VERTEX AI PIPELINE</text>
  <text x="778" y="402" text-anchor="middle" font-size="7" fill="#b71c1c">Production automated training</text>

  <!-- Trigger -->
  <rect x="634" y="412" width="288" height="30" rx="5" fill="#fff" stroke="#c62828" stroke-width="0.8"/>
  <text x="778" y="425" text-anchor="middle" font-size="7.5" font-weight="600" fill="#b71c1c">‚ö° GitHub Actions Trigger</text>
  <text x="778" y="436" text-anchor="middle" font-size="6.5" fill="#495057">model-training.yml ‚Üí Vertex AI submit</text>

  <line x1="778" y1="442" x2="778" y2="450" stroke="#c62828" stroke-width="0.8" marker-end="url(#arrowRed)"/>

  <!-- Data + Build -->
  <rect x="634" y="452" width="138" height="40" rx="5" fill="#fff" stroke="#c62828" stroke-width="0.8"/>
  <text x="703" y="466" text-anchor="middle" font-size="7" font-weight="600" fill="#b71c1c">üì¶ GCS Data</text>
  <text x="703" y="478" text-anchor="middle" font-size="6.5" fill="#495057">gs://ai-product-</text>
  <text x="703" y="488" text-anchor="middle" font-size="6.5" fill="#495057">detector-487013</text>

  <rect x="784" y="452" width="138" height="40" rx="5" fill="#fff" stroke="#c62828" stroke-width="0.8"/>
  <text x="853" y="466" text-anchor="middle" font-size="7" font-weight="600" fill="#b71c1c">üê≥ Docker Build</text>
  <text x="853" y="478" text-anchor="middle" font-size="6.5" fill="#495057">Dockerfile.training</text>
  <text x="853" y="488" text-anchor="middle" font-size="6.5" fill="#495057">‚Üí Artifact Registry</text>

  <line x1="703" y1="492" x2="703" y2="500" stroke="#c62828" stroke-width="0.8" marker-end="url(#arrowRed)"/>
  <line x1="853" y1="492" x2="853" y2="500" stroke="#c62828" stroke-width="0.8" marker-end="url(#arrowRed)"/>

  <!-- Training -->
  <rect x="634" y="502" width="288" height="38" rx="5" fill="#fff" stroke="#c62828" stroke-width="0.8"/>
  <text x="778" y="517" text-anchor="middle" font-size="7.5" font-weight="600" fill="#b71c1c">üî• Vertex AI Custom Job (T4 GPU)</text>
  <text x="778" y="529" text-anchor="middle" font-size="6.5" fill="#495057">n1-standard-4 + NVIDIA Tesla T4 | src/training/vertex_submit.py</text>

  <line x1="778" y1="540" x2="778" y2="548" stroke="#c62828" stroke-width="0.8" marker-end="url(#arrowRed)"/>

  <!-- Evaluate + Gate -->
  <rect x="634" y="550" width="138" height="36" rx="5" fill="#fff" stroke="#c62828" stroke-width="0.8"/>
  <text x="703" y="564" text-anchor="middle" font-size="7" font-weight="600" fill="#b71c1c">üìà Evaluate</text>
  <text x="703" y="576" text-anchor="middle" font-size="6.5" fill="#495057">Test set metrics</text>

  <rect x="784" y="550" width="138" height="36" rx="5" fill="#fff" stroke="#c62828" stroke-width="0.8"/>
  <text x="853" y="564" text-anchor="middle" font-size="7" font-weight="600" fill="#b71c1c">üö¶ Quality Gate</text>
  <text x="853" y="576" text-anchor="middle" font-size="6.5" fill="#495057">Acc‚â•0.85 F1‚â•0.80</text>

  <line x1="772" y1="568" x2="782" y2="568" stroke="#c62828" stroke-width="0.8" marker-end="url(#arrowRed)"/>

  <!-- Auto Deploy -->
  <rect x="634" y="600" width="288" height="30" rx="5" fill="#ffebee" stroke="#c62828" stroke-width="0.6"/>
  <text x="778" y="613" text-anchor="middle" font-size="7" font-weight="600" fill="#b71c1c">üöÄ Auto-Deploy to Cloud Run</text>
  <text x="778" y="624" text-anchor="middle" font-size="6" fill="#6c757d">Quality gate pass ‚Üí GCS model ‚Üí cd.yml ‚Üí Cloud Run</text>

  <line x1="853" y1="586" x2="853" y2="592" stroke="#c62828" stroke-width="0.6"/>
  <path d="M853,592 L930,592 L930,615 L922,615" fill="none" stroke="#c62828" stroke-width="0.6" marker-end="url(#arrowRed)"/>

  <!-- Best for tag -->
  <rect x="634" y="638" width="288" height="20" rx="4" fill="#c62828" stroke="none"/>
  <text x="778" y="652" text-anchor="middle" font-size="7" font-weight="600" fill="#fff">Best for: production, CI/CD automation, reproducibility</text>


  <!-- ‚îÄ‚îÄ‚îÄ Common model output arrow ‚îÄ‚îÄ‚îÄ -->
  <!-- Arrow from all 3 paths converging to model artifact -->
  <text x="480" y="682" text-anchor="middle" font-size="8" font-weight="600" fill="#495057">All paths produce: best_model.pt ‚Üí GCS ‚Üí Cloud Run deployment</text>

  <!-- ============================================================ -->
  <!-- SECTION 3: INFERENCE LAYER (blue) -->
  <!-- ============================================================ -->
  <rect x="14" y="700" width="580" height="180" rx="10" fill="url(#inferGrad)" stroke="#0069d9" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="304" y="718" text-anchor="middle" font-size="11" font-weight="700" fill="#003d80">INFERENCE LAYER  (FastAPI + Streamlit)</text>

  <!-- API Endpoints group -->
  <rect x="28" y="728" width="272" height="140" rx="6" fill="#fff" stroke="#0069d9" stroke-width="1"/>
  <text x="164" y="743" text-anchor="middle" font-size="8.5" font-weight="700" fill="#003d80">API Endpoints (FastAPI)</text>
  <text x="38" y="758" font-size="7" fill="#495057" font-weight="600">POST /predict          POST /predict/explain</text>
  <text x="38" y="770" font-size="7" fill="#495057" font-weight="600">POST /predict/batch    POST /predict/compare</text>
  <line x1="36" y1="776" x2="292" y2="776" stroke="#dee2e6" stroke-width="0.5"/>
  <text x="38" y="789" font-size="7" fill="#6c757d">GET  /health  /metrics  /docs  /liveness  /ready</text>
  <text x="38" y="801" font-size="6.5" fill="#868e96">Rate limiting (slowapi) | API Key auth | CORS</text>

  <!-- Predictor + GradCAM + Shadow -->
  <rect x="310" y="728" width="132" height="40" rx="6" fill="#fff" stroke="#0069d9" stroke-width="1"/>
  <text x="376" y="744" text-anchor="middle" font-size="8" font-weight="600" fill="#003d80">Predictor</text>
  <text x="376" y="756" text-anchor="middle" font-size="6.5" fill="#495057">EfficientNet-B0 | Real/AI</text>

  <rect x="310" y="774" width="132" height="34" rx="6" fill="#fff" stroke="#0069d9" stroke-width="1"/>
  <text x="376" y="788" text-anchor="middle" font-size="8" font-weight="600" fill="#003d80">GradCAM + Shadow A/B</text>
  <text x="376" y="800" text-anchor="middle" font-size="6.5" fill="#495057">Explainability &amp; comparison</text>

  <!-- Frontend -->
  <rect x="452" y="728" width="130" height="80" rx="6" fill="#fff" stroke="#3b82f6" stroke-width="1"/>
  <text x="517" y="744" text-anchor="middle" font-size="8.5" font-weight="600" fill="#1e3a5f">Streamlit UI</text>
  <text x="517" y="758" text-anchor="middle" font-size="6.5" fill="#495057">Image upload</text>
  <text x="517" y="769" text-anchor="middle" font-size="6.5" fill="#495057">GradCAM viz</text>
  <text x="517" y="780" text-anchor="middle" font-size="6.5" fill="#495057">Confidence display</text>
  <text x="517" y="793" text-anchor="middle" font-size="6.5" fill="#495057">Auto-compress</text>

  <!-- Arrow: Streamlit -> API -->
  <line x1="452" y1="768" x2="444" y2="768" stroke="#0069d9" stroke-width="1.0" marker-end="url(#arrowBlue)"/>
  <text x="446" y="762" font-size="5.5" fill="#0069d9">HTTP</text>

  <!-- Middleware -->
  <rect x="28" y="848" width="554" height="22" rx="4" fill="#e3f1ff" stroke="#0069d9" stroke-width="0.6"/>
  <text x="304" y="863" text-anchor="middle" font-size="7" fill="#003d80">Middleware: CORS | Request ID | Metrics | Structured Logging (structlog) | Pydantic schemas</text>

  <!-- Deploy label -->
  <text x="304" y="876" text-anchor="middle" font-size="7" fill="#003d80" font-weight="600">Deployed on Google Cloud Run (API + UI)</text>

  <!-- Arrow from training paths to inference -->
  <path d="M480,686 L480,698" fill="none" stroke="#495057" stroke-width="1.4" marker-end="url(#arrow)"/>

  <!-- ============================================================ -->
  <!-- SECTION 4: MONITORING (purple) -->
  <!-- ============================================================ -->
  <rect x="608" y="700" width="338" height="180" rx="10" fill="url(#monGrad)" stroke="#7b4fa0" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="777" y="718" text-anchor="middle" font-size="11" font-weight="700" fill="#4a235a">MONITORING</text>

  <!-- Prometheus -->
  <rect x="622" y="728" width="152" height="48" rx="6" fill="#fff" stroke="#7b4fa0" stroke-width="1"/>
  <text x="698" y="744" text-anchor="middle" font-size="8.5" font-weight="600" fill="#4a235a">Prometheus</text>
  <text x="698" y="756" text-anchor="middle" font-size="6.5" fill="#495057">predictions_total, latency</text>
  <text x="698" y="767" text-anchor="middle" font-size="6.5" fill="#495057">batch_size, model_loaded</text>

  <!-- Grafana -->
  <rect x="784" y="728" width="148" height="48" rx="6" fill="#fff" stroke="#7b4fa0" stroke-width="1"/>
  <text x="858" y="744" text-anchor="middle" font-size="8.5" font-weight="600" fill="#4a235a">Grafana</text>
  <text x="858" y="756" text-anchor="middle" font-size="6.5" fill="#495057">16-panel dashboard</text>
  <text x="858" y="767" text-anchor="middle" font-size="6.5" fill="#495057">Alerts &amp; visualization</text>

  <!-- Arrow: Prometheus -> Grafana -->
  <line x1="774" y1="752" x2="782" y2="752" stroke="#7b4fa0" stroke-width="0.9" marker-end="url(#arrowPurple)"/>

  <!-- Drift Detection -->
  <rect x="622" y="784" width="310" height="36" rx="6" fill="#fff" stroke="#7b4fa0" stroke-width="1"/>
  <text x="777" y="798" text-anchor="middle" font-size="8" font-weight="600" fill="#4a235a">Drift Detection</text>
  <text x="777" y="810" text-anchor="middle" font-size="6.5" fill="#495057">Probability distribution shift | Low confidence ratio | drift_score gauge</text>

  <!-- Structured Logging -->
  <rect x="622" y="828" width="310" height="28" rx="6" fill="#fff" stroke="#7b4fa0" stroke-width="1"/>
  <text x="777" y="845" text-anchor="middle" font-size="8" font-weight="600" fill="#4a235a">Structured Logging (JSON + structlog + Request IDs)</text>

  <!-- Arrow: Inference -> Prometheus -->
  <line x1="594" y1="752" x2="620" y2="752" stroke="#7b4fa0" stroke-width="1.2" stroke-dasharray="3,2" marker-end="url(#arrowPurple)"/>
  <text x="604" y="746" font-size="5.5" fill="#7b4fa0">/metrics</text>

  <!-- ============================================================ -->
  <!-- SECTION 5: INFRASTRUCTURE (gray) -->
  <!-- ============================================================ -->
  <rect x="14" y="892" width="932" height="110" rx="10" fill="url(#infraGrad)" stroke="#6c757d" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="480" y="910" text-anchor="middle" font-size="11" font-weight="700" fill="#343a40">INFRASTRUCTURE</text>

  <!-- Docker -->
  <rect x="28" y="920" width="160" height="40" rx="6" fill="#fff" stroke="#6c757d" stroke-width="1"/>
  <text x="108" y="936" text-anchor="middle" font-size="8" font-weight="600" fill="#343a40">Docker</text>
  <text x="108" y="948" text-anchor="middle" font-size="6.5" fill="#495057">Dockerfile (API) | ui.Dockerfile</text>
  <text x="108" y="957" text-anchor="middle" font-size="6" fill="#6c757d">Dockerfile.training (Vertex AI)</text>

  <!-- GCP -->
  <rect x="198" y="920" width="220" height="40" rx="6" fill="#fff" stroke="#6c757d" stroke-width="1"/>
  <text x="308" y="936" text-anchor="middle" font-size="8" font-weight="600" fill="#343a40">Google Cloud Platform</text>
  <text x="308" y="948" text-anchor="middle" font-size="6.5" fill="#495057">Artifact Registry | Cloud Run | Vertex AI | GCS</text>
  <text x="308" y="957" text-anchor="middle" font-size="6" fill="#6c757d">gs://ai-product-detector-487013</text>

  <!-- CI/CD -->
  <rect x="428" y="920" width="298" height="40" rx="6" fill="#fff" stroke="#6c757d" stroke-width="1"/>
  <text x="577" y="936" text-anchor="middle" font-size="8" font-weight="600" fill="#343a40">GitHub Actions CI/CD</text>
  <rect x="438" y="942" width="60" height="14" rx="3" fill="#f6f8fa" stroke="#d1d5da" stroke-width="0.5"/>
  <text x="468" y="952" text-anchor="middle" font-size="6" font-weight="600" fill="#24292e">ci.yml</text>
  <rect x="504" y="942" width="60" height="14" rx="3" fill="#f6f8fa" stroke="#d1d5da" stroke-width="0.5"/>
  <text x="534" y="952" text-anchor="middle" font-size="6" font-weight="600" fill="#24292e">cd.yml</text>
  <rect x="570" y="942" width="90" height="14" rx="3" fill="#fce4ec" stroke="#c62828" stroke-width="0.5"/>
  <text x="615" y="952" text-anchor="middle" font-size="6" font-weight="600" fill="#b71c1c">model-training.yml</text>
  <rect x="666" y="942" width="52" height="14" rx="3" fill="#f6f8fa" stroke="#d1d5da" stroke-width="0.5"/>
  <text x="692" y="952" text-anchor="middle" font-size="6" font-weight="600" fill="#24292e">tooling</text>

  <!-- Config -->
  <rect x="736" y="920" width="196" height="40" rx="6" fill="#fff" stroke="#6c757d" stroke-width="1"/>
  <text x="834" y="936" text-anchor="middle" font-size="8" font-weight="600" fill="#343a40">Config Files</text>
  <text x="834" y="948" text-anchor="middle" font-size="6.5" fill="#495057">pyproject.toml | docker-compose.yml</text>
  <text x="834" y="957" text-anchor="middle" font-size="6" fill="#6c757d">train_config.yaml | inference_config.yaml</text>

  <!-- Config files bar -->
  <rect x="28" y="968" width="904" height="22" rx="4" fill="#f8f9fa" stroke="#6c757d" stroke-width="0.6"/>
  <text x="480" y="983" text-anchor="middle" font-size="7" fill="#6c757d">Makefile | prometheus.yml | ruff | mypy | pytest | pre-commit hooks | DVC remote config</text>

  <!-- ============================================================ -->
  <!-- LEGEND -->
  <!-- ============================================================ -->
  <rect x="14" y="1006" width="932" height="46" rx="8" fill="#fff" stroke="#dee2e6" stroke-width="1" filter="url(#shadow)"/>

  <rect x="28" y="1018" width="12" height="10" rx="2" fill="#d4edda" stroke="#28a745" stroke-width="0.8"/>
  <text x="44" y="1027" font-size="7" fill="#343a40">Data (DVC, Kaggle)</text>

  <rect x="136" y="1018" width="12" height="10" rx="2" fill="#ffeeba" stroke="#e67e22" stroke-width="0.8"/>
  <text x="152" y="1027" font-size="7" fill="#343a40">Local Training</text>

  <rect x="224" y="1018" width="12" height="10" rx="2" fill="#fff8e1" stroke="#f57f17" stroke-width="0.8"/>
  <text x="240" y="1027" font-size="7" fill="#343a40">Google Colab</text>

  <rect x="312" y="1018" width="12" height="10" rx="2" fill="#fce4ec" stroke="#c62828" stroke-width="0.8"/>
  <text x="328" y="1027" font-size="7" fill="#343a40">Vertex AI</text>

  <rect x="392" y="1018" width="12" height="10" rx="2" fill="#cce5ff" stroke="#0069d9" stroke-width="0.8"/>
  <text x="408" y="1027" font-size="7" fill="#343a40">Inference (FastAPI, Streamlit)</text>

  <rect x="528" y="1018" width="12" height="10" rx="2" fill="#e2d5f1" stroke="#7b4fa0" stroke-width="0.8"/>
  <text x="544" y="1027" font-size="7" fill="#343a40">Monitoring</text>

  <rect x="604" y="1018" width="12" height="10" rx="2" fill="#e2e3e5" stroke="#6c757d" stroke-width="0.8"/>
  <text x="620" y="1027" font-size="7" fill="#343a40">Infrastructure</text>

  <line x1="688" y1="1023" x2="714" y2="1023" stroke="#495057" stroke-width="1.2" marker-end="url(#arrow)"/>
  <text x="720" y="1026" font-size="7" fill="#343a40">Data flow</text>

  <line x1="782" y1="1023" x2="808" y2="1023" stroke="#c62828" stroke-width="1.2" stroke-dasharray="4,2" marker-end="url(#arrowRed)"/>
  <text x="814" y="1026" font-size="7" fill="#343a40">Model / artifact flow</text>

  <!-- ============================================================ -->
  <!-- CONNECTING ARROWS (data ‚Üí training) -->
  <!-- ============================================================ -->
  <!-- Data Layer ‚Üí Training Paths section -->
  <line x1="159" y1="316" x2="159" y2="324" stroke="#28a745" stroke-width="1.4" marker-end="url(#arrowGreen)"/>

  <!-- Data arrow to local path -->
  <path d="M159,316 L159,330 L169,330 L169,370" fill="none" stroke="#28a745" stroke-width="1.0" marker-end="url(#arrowGreen)"/>

  <!-- HuggingFace arrow to Colab -->
  <text x="467" y="338" text-anchor="middle" font-size="6" fill="#f57f17">HuggingFace Hub</text>
  <line x1="467" y1="341" x2="467" y2="370" stroke="#f57f17" stroke-width="1.0" stroke-dasharray="3,2" marker-end="url(#arrowColab)"/>

  <!-- GCS arrow to Vertex AI -->
  <text x="778" y="338" text-anchor="middle" font-size="6" fill="#c62828">GCS upload</text>
  <line x1="778" y1="341" x2="778" y2="370" stroke="#c62828" stroke-width="1.0" stroke-dasharray="3,2" marker-end="url(#arrowRed)"/>

</svg>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 920" fill="none">
  <defs>
    <!-- Arrow markers -->
    <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#94a3b8"/></marker>
    <marker id="arr-b" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#3b82f6"/></marker>
    <marker id="arr-g" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#059669"/></marker>
    <marker id="arr-p" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#7c3aed"/></marker>
    <marker id="arr-o" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#ea580c"/></marker>
    <marker id="arr-r" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#dc2626"/></marker>
    <!-- Filters -->
    <filter id="sh" x="-2%" y="-2%" width="104%" height="104%"><feDropShadow dx="0" dy="2" stdDeviation="4" flood-color="#000" flood-opacity="0.06"/></filter>
    <filter id="sh-lg" x="-1%" y="-1%" width="102%" height="102%"><feDropShadow dx="0" dy="3" stdDeviation="6" flood-color="#000" flood-opacity="0.08"/></filter>
    <!-- Gradients -->
    <linearGradient id="grad-blue" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#eff6ff"/><stop offset="100%" stop-color="#dbeafe"/></linearGradient>
    <linearGradient id="grad-green" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ecfdf5"/><stop offset="100%" stop-color="#d1fae5"/></linearGradient>
    <linearGradient id="grad-purple" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#faf5ff"/><stop offset="100%" stop-color="#ede9fe"/></linearGradient>
    <linearGradient id="grad-orange" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fff7ed"/><stop offset="100%" stop-color="#ffedd5"/></linearGradient>
    <linearGradient id="grad-red" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fef2f2"/><stop offset="100%" stop-color="#fee2e2"/></linearGradient>
    <linearGradient id="grad-teal" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#f0fdfa"/><stop offset="100%" stop-color="#ccfbf1"/></linearGradient>
  </defs>

  <!-- Background -->
  <rect width="1200" height="920" fill="#f8fafc"/>
  <rect x="0" y="0" width="1200" height="4" fill="#3b82f6" opacity="0.6"/>

  <!-- Title -->
  <text x="600" y="36" text-anchor="middle" fill="#0f172a" font-family="system-ui, -apple-system, sans-serif" font-size="22" font-weight="700">AI Product Photo Detector</text>
  <text x="600" y="54" text-anchor="middle" fill="#64748b" font-family="system-ui, sans-serif" font-size="13">Production MLOps System | EfficientNet-B0 + FastAPI + Vertex AI + Cloud Run</text>

  <!-- ══════════════════════════════════════════════ -->
  <!-- CLIENT LAYER (left) -->
  <!-- ══════════════════════════════════════════════ -->
  <g filter="url(#sh)">
    <rect x="30" y="80" width="155" height="180" rx="12" fill="#ffffff" stroke="#bfdbfe" stroke-width="1.5"/>
  </g>
  <rect x="30" y="80" width="155" height="5" rx="2.5" fill="#3b82f6"/>
  <text x="107" y="106" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="13" font-weight="700" letter-spacing="0.5">CLIENT LAYER</text>

  <!-- cURL -->
  <rect x="45" y="118" width="125" height="30" rx="6" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="0.5"/>
  <text x="107" y="137" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="11" font-weight="600">cURL / HTTPie</text>

  <!-- Streamlit UI -->
  <rect x="45" y="155" width="125" height="30" rx="6" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="0.5"/>
  <text x="107" y="174" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="11" font-weight="600">Streamlit UI</text>

  <!-- Python SDK -->
  <rect x="45" y="192" width="125" height="30" rx="6" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="0.5"/>
  <text x="107" y="211" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="11" font-weight="600">Python SDK</text>

  <text x="107" y="250" text-anchor="middle" fill="#94a3b8" font-family="monospace" font-size="8">REST API calls</text>

  <!-- Arrow: Clients → Cloud Run -->
  <line x1="185" y1="170" x2="225" y2="170" stroke="#3b82f6" stroke-width="2" marker-end="url(#arr-b)"/>

  <!-- ══════════════════════════════════════════════ -->
  <!-- GOOGLE CLOUD RUN (center-left, main box) -->
  <!-- ══════════════════════════════════════════════ -->
  <g filter="url(#sh-lg)">
    <rect x="235" y="72" width="390" height="200" rx="14" fill="#ffffff" stroke="#a7f3d0" stroke-width="1.5"/>
  </g>
  <rect x="235" y="72" width="390" height="5" rx="2.5" fill="#059669"/>
  <text x="430" y="97" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="14" font-weight="700" letter-spacing="0.5">GOOGLE CLOUD RUN</text>
  <text x="430" y="112" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="10">Serverless API | Auto-scaling 0 to N</text>

  <!-- FastAPI Server -->
  <g filter="url(#sh)">
    <rect x="252" y="122" width="105" height="42" rx="7" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="0.5"/>
  </g>
  <text x="304" y="140" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="10" font-weight="700">FastAPI Server</text>
  <text x="304" y="155" text-anchor="middle" fill="#047857" font-family="monospace" font-size="8">Uvicorn async</text>

  <!-- Auth Middleware -->
  <g filter="url(#sh)">
    <rect x="366" y="122" width="105" height="42" rx="7" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="0.5"/>
  </g>
  <text x="418" y="140" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Auth Middleware</text>
  <text x="418" y="155" text-anchor="middle" fill="#047857" font-family="monospace" font-size="8">HMAC API keys</text>

  <!-- Rate Limiter -->
  <g filter="url(#sh)">
    <rect x="480" y="122" width="105" height="42" rx="7" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="0.5"/>
  </g>
  <text x="532" y="140" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Rate Limiter</text>
  <text x="532" y="155" text-anchor="middle" fill="#047857" font-family="monospace" font-size="8">slowapi</text>

  <!-- Predictor Engine -->
  <g filter="url(#sh)">
    <rect x="252" y="176" width="105" height="42" rx="7" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="0.5"/>
  </g>
  <text x="304" y="194" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Predictor Engine</text>
  <text x="304" y="209" text-anchor="middle" fill="#047857" font-family="monospace" font-size="8">EfficientNet-B0</text>

  <!-- Grad-CAM Explainer -->
  <g filter="url(#sh)">
    <rect x="366" y="176" width="105" height="42" rx="7" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="0.5"/>
  </g>
  <text x="418" y="194" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Grad-CAM</text>
  <text x="418" y="209" text-anchor="middle" fill="#047857" font-family="monospace" font-size="8">Explainability</text>

  <!-- Drift Detector -->
  <g filter="url(#sh)">
    <rect x="480" y="176" width="105" height="42" rx="7" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="0.5"/>
  </g>
  <text x="532" y="194" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Drift Detector</text>
  <text x="532" y="209" text-anchor="middle" fill="#047857" font-family="monospace" font-size="8">Sliding window</text>

  <!-- Internal arrows: FastAPI → Auth → Rate Limiter -->
  <line x1="357" y1="143" x2="366" y2="143" stroke="#059669" stroke-width="1" marker-end="url(#arr-g)"/>
  <line x1="471" y1="143" x2="480" y2="143" stroke="#059669" stroke-width="1" marker-end="url(#arr-g)"/>
  <!-- FastAPI → Predictor -->
  <line x1="304" y1="164" x2="304" y2="176" stroke="#059669" stroke-width="1" marker-end="url(#arr-g)"/>

  <!-- Prometheus Metrics label -->
  <rect x="255" y="230" width="355" height="18" rx="4" fill="#ecfdf5" stroke="#a7f3d0" stroke-width="0.5"/>
  <text x="432" y="243" text-anchor="middle" fill="#047857" font-family="system-ui, sans-serif" font-size="9">Prometheus Metrics: 12+ custom counters, histograms, gauges</text>

  <!-- ══════════════════════════════════════════════ -->
  <!-- MONITORING (top-right) -->
  <!-- ══════════════════════════════════════════════ -->
  <g filter="url(#sh)">
    <rect x="650" y="80" width="200" height="140" rx="12" fill="#ffffff" stroke="#fecaca" stroke-width="1.5"/>
  </g>
  <rect x="650" y="80" width="200" height="5" rx="2.5" fill="#dc2626"/>
  <text x="750" y="106" text-anchor="middle" fill="#991b1b" font-family="system-ui, sans-serif" font-size="13" font-weight="700" letter-spacing="0.5">MONITORING</text>

  <!-- Prometheus -->
  <rect x="665" y="116" width="170" height="26" rx="5" fill="url(#grad-red)" stroke="#fecaca" stroke-width="0.5"/>
  <text x="750" y="133" text-anchor="middle" fill="#991b1b" font-family="system-ui, sans-serif" font-size="10" font-weight="600">Prometheus</text>

  <!-- Grafana -->
  <rect x="665" y="148" width="170" height="26" rx="5" fill="url(#grad-red)" stroke="#fecaca" stroke-width="0.5"/>
  <text x="750" y="165" text-anchor="middle" fill="#991b1b" font-family="system-ui, sans-serif" font-size="10" font-weight="600">Grafana Dashboards</text>

  <!-- Alerting -->
  <rect x="665" y="180" width="170" height="26" rx="5" fill="url(#grad-red)" stroke="#fecaca" stroke-width="0.5"/>
  <text x="750" y="197" text-anchor="middle" fill="#991b1b" font-family="system-ui, sans-serif" font-size="10" font-weight="600">Alerting + Structured Logs</text>

  <!-- Arrow: Cloud Run → Monitoring -->
  <line x1="625" y1="150" x2="650" y2="150" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arr-r)" stroke-dasharray="5,3"/>
  <text x="638" y="142" text-anchor="middle" fill="#dc2626" font-family="system-ui, sans-serif" font-size="8">/metrics</text>

  <!-- ══════════════════════════════════════════════ -->
  <!-- INFRASTRUCTURE (far-right) -->
  <!-- ══════════════════════════════════════════════ -->
  <g filter="url(#sh)">
    <rect x="875" y="72" width="295" height="200" rx="12" fill="#ffffff" stroke="#fed7aa" stroke-width="1.5"/>
  </g>
  <rect x="875" y="72" width="295" height="5" rx="2.5" fill="#ea580c"/>
  <text x="1022" y="97" text-anchor="middle" fill="#7c2d12" font-family="system-ui, sans-serif" font-size="13" font-weight="700" letter-spacing="0.5">INFRASTRUCTURE</text>

  <!-- GCS Buckets -->
  <g filter="url(#sh)">
    <rect x="892" y="110" width="125" height="48" rx="7" fill="url(#grad-orange)" stroke="#fed7aa" stroke-width="0.5"/>
  </g>
  <text x="954" y="130" text-anchor="middle" fill="#7c2d12" font-family="system-ui, sans-serif" font-size="10" font-weight="700">GCS Buckets</text>
  <text x="954" y="145" text-anchor="middle" fill="#9a3412" font-family="monospace" font-size="8">Data + Models + Staging</text>

  <!-- Vertex AI Training -->
  <g filter="url(#sh)">
    <rect x="1027" y="110" width="125" height="48" rx="7" fill="url(#grad-orange)" stroke="#fed7aa" stroke-width="0.5"/>
  </g>
  <text x="1089" y="130" text-anchor="middle" fill="#7c2d12" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Vertex AI</text>
  <text x="1089" y="145" text-anchor="middle" fill="#9a3412" font-family="monospace" font-size="8">T4 GPU Training</text>

  <!-- Docker + Cloud Build -->
  <g filter="url(#sh)">
    <rect x="892" y="168" width="125" height="48" rx="7" fill="url(#grad-orange)" stroke="#fed7aa" stroke-width="0.5"/>
  </g>
  <text x="954" y="188" text-anchor="middle" fill="#7c2d12" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Docker</text>
  <text x="954" y="203" text-anchor="middle" fill="#9a3412" font-family="monospace" font-size="8">Cloud Build + Registry</text>

  <!-- Terraform IaC -->
  <g filter="url(#sh)">
    <rect x="1027" y="168" width="125" height="48" rx="7" fill="url(#grad-orange)" stroke="#fed7aa" stroke-width="0.5"/>
  </g>
  <text x="1089" y="188" text-anchor="middle" fill="#7c2d12" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Terraform IaC</text>
  <text x="1089" y="203" text-anchor="middle" fill="#9a3412" font-family="monospace" font-size="8">Modular GCP setup</text>

  <!-- Label: Artifact Registry -->
  <rect x="895" y="228" width="257" height="18" rx="4" fill="#fff7ed" stroke="#fed7aa" stroke-width="0.5"/>
  <text x="1022" y="241" text-anchor="middle" fill="#9a3412" font-family="system-ui, sans-serif" font-size="9">Artifact Registry: API + Training + UI images</text>

  <!-- Arrow: Infrastructure → Cloud Run -->
  <line x1="875" y1="170" x2="855" y2="170" stroke="#ea580c" stroke-width="1.5" marker-end="url(#arr-o)" stroke-dasharray="5,3"/>

  <!-- ══════════════════════════════════════════════ -->
  <!-- BIG ARROW: Cloud Run → ML Pipeline -->
  <!-- ══════════════════════════════════════════════ -->
  <path d="M 430 272 L 430 298" stroke="#3b82f6" stroke-width="2" marker-end="url(#arr-b)"/>
  <rect x="390" y="280" width="80" height="18" rx="9" fill="#eff6ff" stroke="#bfdbfe" stroke-width="0.5"/>
  <text x="430" y="293" text-anchor="middle" fill="#2563eb" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Model Load</text>

  <!-- ══════════════════════════════════════════════ -->
  <!-- ML PIPELINE (large center container) -->
  <!-- ══════════════════════════════════════════════ -->
  <g filter="url(#sh-lg)">
    <rect x="30" y="310" width="1140" height="230" rx="16" fill="#ffffff" stroke="#e2e8f0" stroke-width="1.5"/>
  </g>
  <rect x="30" y="310" width="1140" height="5" rx="2.5" fill="#7c3aed"/>
  <text x="600" y="338" text-anchor="middle" fill="#4c1d95" font-family="system-ui, sans-serif" font-size="15" font-weight="700" letter-spacing="1">ML PIPELINE</text>
  <text x="600" y="354" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="10">Reproducible DVC pipeline: download --> validate --> train | MLflow experiment tracking</text>

  <!-- Stage 1: Data Collection -->
  <g filter="url(#sh)">
    <rect x="52" y="370" width="190" height="150" rx="10" fill="url(#grad-purple)" stroke="#ddd6fe" stroke-width="1"/>
  </g>
  <text x="147" y="392" text-anchor="middle" fill="#4c1d95" font-family="system-ui, sans-serif" font-size="12" font-weight="700">1. Data Collection</text>
  <text x="147" y="408" text-anchor="middle" fill="#6d28d9" font-family="system-ui, sans-serif" font-size="10">CIFAKE + HuggingFace</text>

  <rect x="65" y="418" width="164" height="22" rx="4" fill="#ffffff" stroke="#ddd6fe" stroke-width="0.5"/>
  <text x="147" y="433" text-anchor="middle" fill="#6d28d9" font-family="monospace" font-size="8">2500 images/class (Real + AI)</text>

  <text x="147" y="458" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Download from GCS</text>
  <text x="147" y="473" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Integrity validation</text>
  <text x="147" y="488" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Train / Val / Test split</text>

  <rect x="90" y="498" width="115" height="14" rx="3" fill="#ede9fe"/>
  <text x="147" y="509" text-anchor="middle" fill="#4c1d95" font-family="monospace" font-size="8">DVC stage: download</text>

  <!-- Arrow 1→2 -->
  <path d="M 242 445 L 275 445" stroke="#7c3aed" stroke-width="2" marker-end="url(#arr-p)"/>

  <!-- Stage 2: Preprocessing + Augmentation -->
  <g filter="url(#sh)">
    <rect x="285" y="370" width="190" height="150" rx="10" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="1"/>
  </g>
  <text x="380" y="392" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="12" font-weight="700">2. Preprocessing</text>
  <text x="380" y="408" text-anchor="middle" fill="#2563eb" font-family="system-ui, sans-serif" font-size="10">Augmentation Pipeline</text>

  <rect x="298" y="418" width="164" height="22" rx="4" fill="#ffffff" stroke="#bfdbfe" stroke-width="0.5"/>
  <text x="380" y="433" text-anchor="middle" fill="#2563eb" font-family="monospace" font-size="8">224x224 resize + normalize</text>

  <text x="380" y="458" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Horizontal flip + rotation</text>
  <text x="380" y="473" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Color jitter + random crop</text>
  <text x="380" y="488" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">ImageNet normalization</text>

  <rect x="325" y="498" width="115" height="14" rx="3" fill="#dbeafe"/>
  <text x="382" y="509" text-anchor="middle" fill="#1e40af" font-family="monospace" font-size="8">DVC stage: validate</text>

  <!-- Arrow 2→3 -->
  <path d="M 475 445 L 508 445" stroke="#3b82f6" stroke-width="2" marker-end="url(#arr-b)"/>

  <!-- Stage 3: EfficientNet-B0 Training -->
  <g filter="url(#sh)">
    <rect x="518" y="370" width="190" height="150" rx="10" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="1"/>
  </g>
  <text x="613" y="392" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="12" font-weight="700">3. Model Training</text>
  <text x="613" y="408" text-anchor="middle" fill="#047857" font-family="system-ui, sans-serif" font-size="10">EfficientNet-B0</text>

  <rect x="531" y="418" width="164" height="22" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="0.5"/>
  <text x="613" y="433" text-anchor="middle" fill="#047857" font-family="monospace" font-size="8">Transfer learning (ImageNet)</text>

  <text x="613" y="458" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">AdamW + cosine annealing</text>
  <text x="613" y="473" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Early stopping (patience: 5)</text>
  <text x="613" y="488" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">MLflow experiment tracking</text>

  <rect x="556" y="498" width="115" height="14" rx="3" fill="#d1fae5"/>
  <text x="613" y="509" text-anchor="middle" fill="#065f46" font-family="monospace" font-size="8">DVC stage: train</text>

  <!-- Arrow 3→4 -->
  <path d="M 708 445 L 741 445" stroke="#059669" stroke-width="2" marker-end="url(#arr-g)"/>

  <!-- Stage 4: Quality Gate + Registry -->
  <g filter="url(#sh)">
    <rect x="751" y="370" width="190" height="150" rx="10" fill="url(#grad-orange)" stroke="#fed7aa" stroke-width="1"/>
  </g>
  <text x="846" y="392" text-anchor="middle" fill="#7c2d12" font-family="system-ui, sans-serif" font-size="12" font-weight="700">4. Quality Gate</text>
  <text x="846" y="408" text-anchor="middle" fill="#c2410c" font-family="system-ui, sans-serif" font-size="10">Evaluation + Registry</text>

  <!-- Gate pill -->
  <rect x="764" y="418" width="164" height="22" rx="4" fill="#ffffff" stroke="#fed7aa" stroke-width="0.5"/>
  <text x="846" y="433" text-anchor="middle" fill="#c2410c" font-family="monospace" font-size="8">acc &gt;= 0.85 | F1 &gt;= 0.80</text>

  <text x="846" y="458" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Accuracy, F1, Precision, Recall</text>
  <text x="846" y="473" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Model versioning (GCS)</text>
  <text x="846" y="488" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">best_model.pt checkpoint</text>

  <!-- Pass/Fail badges -->
  <rect x="770" y="498" width="55" height="16" rx="4" fill="#dcfce7" stroke="#86efac" stroke-width="0.5"/>
  <text x="797" y="510" text-anchor="middle" fill="#166534" font-family="system-ui, sans-serif" font-size="8" font-weight="700">PASS</text>
  <rect x="830" y="498" width="55" height="16" rx="4" fill="#fef2f2" stroke="#fecaca" stroke-width="0.5"/>
  <text x="857" y="510" text-anchor="middle" fill="#991b1b" font-family="system-ui, sans-serif" font-size="8" font-weight="700">FAIL</text>
  <text x="898" y="510" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="8">Retrain</text>

  <!-- Arrow 4→5 -->
  <path d="M 941 445 L 974 445" stroke="#ea580c" stroke-width="2" marker-end="url(#arr-o)"/>

  <!-- Stage 5: Model Registry / Deploy -->
  <g filter="url(#sh)">
    <rect x="984" y="370" width="170" height="150" rx="10" fill="url(#grad-teal)" stroke="#99f6e4" stroke-width="1"/>
  </g>
  <text x="1069" y="392" text-anchor="middle" fill="#134e4a" font-family="system-ui, sans-serif" font-size="12" font-weight="700">5. Deploy</text>
  <text x="1069" y="408" text-anchor="middle" fill="#0d9488" font-family="system-ui, sans-serif" font-size="10">Model Registry</text>

  <rect x="997" y="418" width="144" height="22" rx="4" fill="#ffffff" stroke="#99f6e4" stroke-width="0.5"/>
  <text x="1069" y="433" text-anchor="middle" fill="#0d9488" font-family="monospace" font-size="8">GCS + MLflow artifacts</text>

  <text x="1069" y="458" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Docker image build</text>
  <text x="1069" y="473" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Push to Artifact Registry</text>
  <text x="1069" y="488" text-anchor="middle" fill="#6b7280" font-family="system-ui, sans-serif" font-size="9">Cloud Run deploy</text>

  <rect x="1010" y="498" width="115" height="14" rx="3" fill="#ccfbf1"/>
  <text x="1067" y="509" text-anchor="middle" fill="#134e4a" font-family="monospace" font-size="8">Smoke test + verify</text>

  <!-- Arrow: Deploy → back to Cloud Run (feedback loop) -->
  <path d="M 1069 370 L 1069 265 L 625 265" stroke="#0d9488" stroke-width="1.5" marker-end="url(#arr)" stroke-dasharray="5,3"/>
  <text x="850" y="258" text-anchor="middle" fill="#0d9488" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Deploy new model version</text>

  <!-- ══════════════════════════════════════════════ -->
  <!-- CI/CD PIPELINE (bottom section) -->
  <!-- ══════════════════════════════════════════════ -->
  <g filter="url(#sh-lg)">
    <rect x="30" y="560" width="740" height="175" rx="16" fill="#ffffff" stroke="#e2e8f0" stroke-width="1.5"/>
  </g>
  <rect x="30" y="560" width="740" height="5" rx="2.5" fill="#1e293b"/>
  <text x="400" y="587" text-anchor="middle" fill="#0f172a" font-family="system-ui, sans-serif" font-size="14" font-weight="700" letter-spacing="1">CI/CD PIPELINE</text>
  <text x="400" y="603" text-anchor="middle" fill="#64748b" font-family="system-ui, sans-serif" font-size="10">GitHub Actions | 4 workflows: CI, CD, Model Training, PR Preview</text>

  <!-- CI flow -->
  <text x="52" y="628" fill="#475569" font-family="system-ui, sans-serif" font-size="10" font-weight="700">CI (Continuous Integration)</text>

  <rect x="52" y="636" width="72" height="30" rx="6" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="1"/>
  <text x="88" y="655" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Git Push</text>

  <text x="131" y="655" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="142" y="636" width="72" height="30" rx="6" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="1"/>
  <text x="178" y="655" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Ruff Lint</text>

  <text x="221" y="655" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="232" y="636" width="72" height="30" rx="6" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="1"/>
  <text x="268" y="655" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="9" font-weight="600">mypy Types</text>

  <text x="311" y="655" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="322" y="636" width="85" height="30" rx="6" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="1"/>
  <text x="364" y="655" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="9" font-weight="600">pytest (3.11/12)</text>

  <text x="414" y="655" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="425" y="636" width="80" height="30" rx="6" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="1"/>
  <text x="465" y="655" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Security Scan</text>

  <text x="512" y="655" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="523" y="636" width="35" height="30" rx="6" fill="#dcfce7" stroke="#86efac" stroke-width="1"/>
  <text x="540" y="655" text-anchor="middle" fill="#166534" font-family="system-ui, sans-serif" font-size="12" font-weight="700">OK</text>

  <!-- CD flow -->
  <text x="52" y="690" fill="#475569" font-family="system-ui, sans-serif" font-size="10" font-weight="700">CD (Continuous Deployment)</text>

  <rect x="52" y="698" width="90" height="30" rx="6" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="1"/>
  <text x="97" y="717" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Docker Build</text>

  <text x="149" y="717" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="160" y="698" width="115" height="30" rx="6" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="1"/>
  <text x="217" y="717" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Push Artifact Registry</text>

  <text x="282" y="717" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="293" y="698" width="105" height="30" rx="6" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="1"/>
  <text x="345" y="717" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Cloud Run Deploy</text>

  <text x="405" y="717" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="416" y="698" width="82" height="30" rx="6" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="1"/>
  <text x="457" y="717" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="9" font-weight="600">Smoke Test</text>

  <text x="505" y="717" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="11">-></text>

  <rect x="516" y="698" width="35" height="30" rx="6" fill="#dcfce7" stroke="#86efac" stroke-width="1"/>
  <text x="533" y="717" text-anchor="middle" fill="#166534" font-family="system-ui, sans-serif" font-size="12" font-weight="700">OK</text>

  <!-- Quality tools -->
  <text x="600" y="628" fill="#475569" font-family="system-ui, sans-serif" font-size="10" font-weight="700">Quality Tools</text>
  <rect x="600" y="636" width="55" height="22" rx="4" fill="#f1f5f9"/>
  <text x="627" y="651" text-anchor="middle" fill="#475569" font-family="monospace" font-size="9">Ruff</text>
  <rect x="660" y="636" width="55" height="22" rx="4" fill="#f1f5f9"/>
  <text x="687" y="651" text-anchor="middle" fill="#475569" font-family="monospace" font-size="9">mypy</text>
  <rect x="600" y="664" width="55" height="22" rx="4" fill="#f1f5f9"/>
  <text x="627" y="679" text-anchor="middle" fill="#475569" font-family="monospace" font-size="9">pytest</text>
  <rect x="660" y="664" width="55" height="22" rx="4" fill="#f1f5f9"/>
  <text x="687" y="679" text-anchor="middle" fill="#475569" font-family="monospace" font-size="9">bandit</text>
  <rect x="600" y="692" width="55" height="22" rx="4" fill="#f1f5f9"/>
  <text x="627" y="707" text-anchor="middle" fill="#475569" font-family="monospace" font-size="9">pip-audit</text>
  <rect x="660" y="692" width="55" height="22" rx="4" fill="#f1f5f9"/>
  <text x="687" y="707" text-anchor="middle" fill="#475569" font-family="monospace" font-size="9">Locust</text>

  <!-- ══════════════════════════════════════════════ -->
  <!-- DOCKER COMPOSE STACK (bottom-right) -->
  <!-- ══════════════════════════════════════════════ -->
  <g filter="url(#sh-lg)">
    <rect x="795" y="560" width="375" height="175" rx="14" fill="#ffffff" stroke="#e2e8f0" stroke-width="1.5"/>
  </g>
  <rect x="795" y="560" width="375" height="5" rx="2.5" fill="#0284c7"/>
  <text x="982" y="587" text-anchor="middle" fill="#0c4a6e" font-family="system-ui, sans-serif" font-size="13" font-weight="700">DOCKER COMPOSE STACK</text>
  <text x="982" y="603" text-anchor="middle" fill="#64748b" font-family="system-ui, sans-serif" font-size="10">Local development environment</text>

  <!-- Service boxes -->
  <rect x="810" y="616" width="78" height="36" rx="5" fill="url(#grad-green)" stroke="#a7f3d0" stroke-width="0.5"/>
  <text x="849" y="632" text-anchor="middle" fill="#065f46" font-family="system-ui, sans-serif" font-size="9" font-weight="700">API</text>
  <text x="849" y="645" text-anchor="middle" fill="#047857" font-family="monospace" font-size="7">:8080</text>

  <rect x="894" y="616" width="78" height="36" rx="5" fill="url(#grad-blue)" stroke="#bfdbfe" stroke-width="0.5"/>
  <text x="933" y="632" text-anchor="middle" fill="#1e40af" font-family="system-ui, sans-serif" font-size="9" font-weight="700">Streamlit</text>
  <text x="933" y="645" text-anchor="middle" fill="#2563eb" font-family="monospace" font-size="7">:8501</text>

  <rect x="978" y="616" width="78" height="36" rx="5" fill="url(#grad-purple)" stroke="#ddd6fe" stroke-width="0.5"/>
  <text x="1017" y="632" text-anchor="middle" fill="#4c1d95" font-family="system-ui, sans-serif" font-size="9" font-weight="700">MLflow</text>
  <text x="1017" y="645" text-anchor="middle" fill="#6d28d9" font-family="monospace" font-size="7">:5000</text>

  <rect x="1062" y="616" width="92" height="36" rx="5" fill="url(#grad-red)" stroke="#fecaca" stroke-width="0.5"/>
  <text x="1108" y="632" text-anchor="middle" fill="#991b1b" font-family="system-ui, sans-serif" font-size="9" font-weight="700">Prometheus</text>
  <text x="1108" y="645" text-anchor="middle" fill="#dc2626" font-family="monospace" font-size="7">:9090</text>

  <rect x="810" y="660" width="78" height="36" rx="5" fill="url(#grad-orange)" stroke="#fed7aa" stroke-width="0.5"/>
  <text x="849" y="676" text-anchor="middle" fill="#7c2d12" font-family="system-ui, sans-serif" font-size="9" font-weight="700">Grafana</text>
  <text x="849" y="689" text-anchor="middle" fill="#9a3412" font-family="monospace" font-size="7">:3000</text>

  <!-- Docker Compose label -->
  <rect x="810" y="710" width="345" height="18" rx="4" fill="#f0f9ff" stroke="#bae6fd" stroke-width="0.5"/>
  <text x="982" y="723" text-anchor="middle" fill="#0369a1" font-family="system-ui, sans-serif" font-size="9">docker compose up: Full local dev stack with hot reload</text>

  <!-- Drift feedback arrow -->
  <path d="M 750 220 C 820 260, 820 320, 750 370" stroke="#dc2626" stroke-width="1" marker-end="url(#arr-r)" stroke-dasharray="4,3"/>
  <text x="800" y="295" text-anchor="middle" fill="#dc2626" font-family="system-ui, sans-serif" font-size="8">Drift triggers retrain</text>

  <!-- ══════════════════════════════════════════════ -->
  <!-- TECH FOOTER -->
  <!-- ══════════════════════════════════════════════ -->
  <line x1="30" y1="758" x2="1170" y2="758" stroke="#e2e8f0" stroke-width="1"/>
  <text x="30" y="778" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="10" font-weight="600" letter-spacing="1.5">STACK</text>

  <g transform="translate(80, 766)">
    <rect x="0" y="0" width="62" height="20" rx="10" fill="#eff6ff" stroke="#bfdbfe" stroke-width="0.5"/><text x="31" y="14" text-anchor="middle" fill="#2563eb" font-family="system-ui, sans-serif" font-size="9">PyTorch</text>
    <rect x="68" y="0" width="62" height="20" rx="10" fill="#eff6ff" stroke="#bfdbfe" stroke-width="0.5"/><text x="99" y="14" text-anchor="middle" fill="#2563eb" font-family="system-ui, sans-serif" font-size="9">FastAPI</text>
    <rect x="136" y="0" width="72" height="20" rx="10" fill="#ecfdf5" stroke="#a7f3d0" stroke-width="0.5"/><text x="172" y="14" text-anchor="middle" fill="#047857" font-family="system-ui, sans-serif" font-size="9">Cloud Run</text>
    <rect x="214" y="0" width="62" height="20" rx="10" fill="#ecfdf5" stroke="#a7f3d0" stroke-width="0.5"/><text x="245" y="14" text-anchor="middle" fill="#047857" font-family="system-ui, sans-serif" font-size="9">Vertex AI</text>
    <rect x="282" y="0" width="78" height="20" rx="10" fill="#f5f3ff" stroke="#ddd6fe" stroke-width="0.5"/><text x="321" y="14" text-anchor="middle" fill="#6d28d9" font-family="system-ui, sans-serif" font-size="9">EfficientNet</text>
    <rect x="366" y="0" width="55" height="20" rx="10" fill="#f5f3ff" stroke="#ddd6fe" stroke-width="0.5"/><text x="393" y="14" text-anchor="middle" fill="#6d28d9" font-family="system-ui, sans-serif" font-size="9">DVC</text>
    <rect x="427" y="0" width="55" height="20" rx="10" fill="#f5f3ff" stroke="#ddd6fe" stroke-width="0.5"/><text x="454" y="14" text-anchor="middle" fill="#6d28d9" font-family="system-ui, sans-serif" font-size="9">MLflow</text>
    <rect x="488" y="0" width="58" height="20" rx="10" fill="#fff7ed" stroke="#fed7aa" stroke-width="0.5"/><text x="517" y="14" text-anchor="middle" fill="#c2410c" font-family="system-ui, sans-serif" font-size="9">Docker</text>
    <rect x="552" y="0" width="68" height="20" rx="10" fill="#fff7ed" stroke="#fed7aa" stroke-width="0.5"/><text x="586" y="14" text-anchor="middle" fill="#c2410c" font-family="system-ui, sans-serif" font-size="9">Terraform</text>
    <rect x="626" y="0" width="75" height="20" rx="10" fill="#fef2f2" stroke="#fecaca" stroke-width="0.5"/><text x="663" y="14" text-anchor="middle" fill="#991b1b" font-family="system-ui, sans-serif" font-size="9">Prometheus</text>
    <rect x="707" y="0" width="58" height="20" rx="10" fill="#fef2f2" stroke="#fecaca" stroke-width="0.5"/><text x="736" y="14" text-anchor="middle" fill="#991b1b" font-family="system-ui, sans-serif" font-size="9">Grafana</text>
    <rect x="771" y="0" width="68" height="20" rx="10" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="0.5"/><text x="805" y="14" text-anchor="middle" fill="#475569" font-family="system-ui, sans-serif" font-size="9">Streamlit</text>
    <rect x="845" y="0" width="72" height="20" rx="10" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="0.5"/><text x="881" y="14" text-anchor="middle" fill="#475569" font-family="system-ui, sans-serif" font-size="9">Grad-CAM</text>
    <rect x="923" y="0" width="55" height="20" rx="10" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="0.5"/><text x="950" y="14" text-anchor="middle" fill="#475569" font-family="system-ui, sans-serif" font-size="9">GCS</text>
  </g>

  <!-- Version label -->
  <text x="1170" y="810" text-anchor="end" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="9">Architecture v2.0 | Built by Nolan Cacheux</text>

  <!-- Subtle connection lines from Infrastructure to ML Pipeline -->
  <line x1="1022" y1="272" x2="1022" y2="310" stroke="#94a3b8" stroke-width="1" marker-end="url(#arr)" stroke-dasharray="4,3"/>
  <text x="1040" y="295" fill="#94a3b8" font-family="system-ui, sans-serif" font-size="8">GCS data</text>

  <!-- Monitoring to ML Pipeline (drift feedback) -->

</svg>